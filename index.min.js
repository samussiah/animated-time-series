!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("slim-select")):"function"==typeof define&&define.amd?define(["slim-select"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).animatedTimeSeries=e(t.SlimSelect)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=e(t);function n(t,e,i){return t.find((function(t){return t[e]===i}))}var a={addElement:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"div",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(t,e){return e};return n?e.selectAll("".concat(i,".atm-").concat(t,".atm-").concat(i)).data(n,a).join(i).classed("atm-".concat(t," atm-").concat(i),!0):e.append(i).classed("atm-".concat(t," atm-").concat(i),!0)},getDatum:n,getValue:function(t,e,i,a){var r=n(t,e,i);return r?r[a]:null}};function r(){var t=this;this.settings.filters=Array.isArray(this.settings.filters)&&this.settings.filters.length>0?this.settings.filters.map((function(t){var e={};return e.var="string"==typeof t?t:t.var,e.label=t.label||t.var,e.value=t.value||"All",e})).filter((function(t){return t.hasOwnProperty("var")&&"string"==typeof t.var})):[],this.settings.footnotes=this.settings.footnotes.map((function(e){return e.replace("[color]",t.settings.color_var.replace("_"," "))})),null!==this.settings.y_limits&&this.settings.footnotes.push("<sup>*</sup> To mitigate the effect of outliers, the range of the y-axis encompasses the ".concat(this.settings.y_limits.map((function(t){return"".concat(t,"th")})).join(" through ")," quantile of the results."))}function s(){return{update:r,id_var:"USUBJID",visit_var:"AVISIT",visit_order_var:"AVISITN",day_var:"ADY",measure_var:"PARAM",result_var:"AVAL",baseline_var:"BASE",change_var:"CHG",percent_change_var:"PCHG",outcome:"result",var_labels:{id:"Participant ID",visit:"Visit",visit_order:"Visit Order",measure:"Measure",result:"Result",baseline:"Baseline",change:"Change",chg:"Change",percent_change:"% Change",pchg:"% Change",fold_change:"Fold Change",fchg:"Fold Change"},aggregate:"mean",play:!0,timepoint:0,speed:2500,loop_delay:5e3,x_var:"day",x_type:"linear",y_var:"result",y_type:"linear",y_limits:null,color_var:"change",color_type:"linear",width:null,height:null,margin:{},footnotes:["<sup>1</sup> The color of points represents [color] from baseline.","<sup>2</sup> The color of lines represents [color] from the previous timepoint."]}}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){l(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function u(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return d(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function g(t){var e=this.layout?this.layout.charts:t;this.settings.width=e.node().clientWidth/2,this.settings.height=this.settings.width/3,this.settings.margin={top:30,right:30,bottom:40,left:40}}function h(t){d3.select(this).transition().duration(t.settings.speed/8).delay(t.settings.speed-t.settings.speed/8*2).style("opacity",0)}function f(t,e){t.style("opacity",0).transition().duration(e.settings.speed/8).style("opacity",1).on("end",(function(){h.call(this,e)}))}function p(){var t={index:this.settings.timepoint,visit:this.set.visit[this.settings.timepoint],day:this.set.timepoint[this.settings.timepoint]};return this.layout.timepoint.text(t.visit).call(f,this),t}function m(t){var e=this;t.lines.each((function(i){var n=i[1].find((function(t){return t.visit===e.timepoint.visit})),a=i[1].findIndex((function(t){return t.visit===e.timepoint.visit})),r=i[1].slice(0,a).pop(),s=d3.select(this);r&&n?s.attr("x1",t.xScale(r[e.settings.x_var])+("ordinal"===e.settings.x_type?t.xScale.bandwidth()/2:0)).attr("y1",t.yScale(r[e.settings.y_var])).attr("x2",t.xScale(r[e.settings.x_var])+("ordinal"===e.settings.x_type?t.xScale.bandwidth()/2:0)).attr("y2",t.yScale(r[e.settings.y_var])).attr("stroke","percent_change"===e.settings.color_var?t.colorScale((n[e.settings.y_var]-r[e.settings.y_var])/r[e.settings.y_var]*100):t.colorScale(n[e.settings.y_var]-r[e.settings.y_var])).attr("stroke-opacity",.25).transition().ease(d3.easeQuad).duration(2*e.settings.speed/5).attr("x2",t.xScale(n[e.settings.x_var])+("ordinal"===e.settings.x_type?t.xScale.bandwidth()/2:0)).attr("y2",t.yScale(n[e.settings.y_var])):s.transition().duration(2*e.settings.speed/5).attr("stroke-opacity",0)}))}function v(t){var e=this;t.points.each((function(i){var n=i[1].find((function(t){return t.visit===e.timepoint.visit})),a=(i[1].find((function(t){return!!t.result})),d3.select(this));0!==e.timepoint.index||n?"none"===a.style("display")&&n&&a.attr("cx",t.xScale(n.day)).attr("cy",t.yScale(n.result)):a.style("display","none");var r=a.transition().ease(d3.easeQuad).duration(2*e.settings.speed/5).delay(1*e.settings.speed/5).attr("fill-opacity",.25).attr("stroke-opacity",.5);n&&r.attr("cx",t.xScale(n[e.settings.x_var])+("ordinal"===e.settings.x_type?t.xScale.bandwidth()/2:0)).attr("cy",t.yScale(n[e.settings.y_var])).attr("fill",t.colorScale(n[e.settings.color_var])).attr("stroke",t.colorScale(n[e.settings.color_var]))}))}function y(t){var e=this;if(t.linesAggregate.filter((function(t,i){return i===e.timepoint.index-1})).transition().duration(2*this.settings.speed/5).delay(1*this.settings.speed/5).attr("x2",(function(i,n){return"ordinal"===e.settings.x_type?t.xScale(e.timepoint.visit)+t.xScale.bandwidth()/2:t.xScale(e.timepoint.day)})).attr("y2",(function(e){return t.yScale(e[1][1])})),0===this.timepoint.index){var i=this.settings.speed/this.set.visit.length;t.linesAggregate.transition().duration(i).delay((function(t,n){return e.settings.speed-i*n})).attr("x2",(function(){return this.getAttribute("x1")})).attr("y2",(function(){return this.getAttribute("y1")}))}}function x(t){var e=this;if(this.timepoint.index>0?t.pointsAggregate.transition().ease(d3.easeQuad).duration(2*this.settings.speed/5).delay(2*this.settings.speed/5).attr("cx","ordinal"===this.settings.x_type?t.xScale(this.timepoint.visit)+t.xScale.bandwidth()/2:t.xScale(this.timepoint.day)).attr("cy",(function(i){return t.yScale(i[e.timepoint.index][1])})).attr("fill",(function(i,n){return t.colorScale(i[e.timepoint.index]["change"===e.settings.color_var?2:3])})):t.pointsAggregate.attr("cx","ordinal"===this.settings.x_type?t.xScale(this.timepoint.visit)+t.xScale.bandwidth()/2:t.xScale(this.timepoint.day)).attr("cy",(function(e){return t.yScale(e[0][1])})).attr("fill",t.colorScale(0)),t.pointsAggregate.clone().classed("atm-clone",!0),0===this.timepoint.index){var i=this.settings.speed/this.set.visit.length;t.layout.timeSeries.canvas.selectAll(".atm-clone").transition().duration(i).delay((function(t,e){return i*e})).attr("fill-opacity",0).attr("stroke-opacity",0).remove()}}function S(){var t=this;this.settings.timepoint++,this.settings.timepoint>=this.set.visit.length&&(this.settings.timepoint=0),this.timepoint=p.call(this),this.group.measure.forEach((function(e,i){m.call(t,e),v.call(t,e),y.call(t,e),x.call(t,e)}))}function _(){var t=this;return d3.interval((function(){S.call(t)}),this.settings.speed)}function b(t){var e=this,i=this.util.addElement("play",t),n=this.util.addElement("button",i,"input").attr("type","button").property("value",this.settings.play?"pause":"play");return n.on("click",(function(t,i){e.settings.play=!e.settings.play,d3.select(this).property("value",e.settings.play?"pause":"play"),e.layout.timepoint.transition().style("opacity",1),e.settings.play?e.interval=_.call(e):e.interval.stop()})),{container:i,input:n}}function w(t){var e=this,i=this.util.addElement("step",t),n=this.util.addElement("button",i,"input",["<",">"]).attr("type","button").property("value",(function(t){return t}));return n.on("click",(function(t,i){e.settings.play=!1,e.controls.play.input.property("value","play"),e.interval&&e.interval.stop(),"<"===this.value&&(e.settings.timepoint=0===e.settings.timepoint?e.set.visit.length-2:e.settings.timepoint-2),S.call(e),e.layout.timepoint.transition().style("opacity",1)})),{container:i,input:n}}function A(t){var e;switch(t){case"measure,id":e=d3.groups(this.data.filtered,(function(t){return t.measure}),(function(t){return t.id}));break;default:e=d3.group(this.data.filtered,(function(e){return e[t]}))}return e}function E(t){t.layout.timeSeries.xAxis.selectAll("*").remove(),t.layout.timeSeries.yAxis.selectAll("*").remove(),t.layout.timeSeries.lines.selectAll("*").remove(),t.layout.timeSeries.points.selectAll("*").remove(),t.layout.timeSeries.pointsAggregate.selectAll("*").remove(),t.layout.timeSeries.linesAggregate.selectAll("*").remove()}function k(t){var e=this;return t.layout.timeSeries.xAxis.attr("transform","translate(0,".concat(this.settings.height-this.settings.margin.bottom,")")).call(d3.axisBottom(t.xScale).ticks(this.settings.width/80)).call((function(t){return t.append("text").attr("x",(e.settings.width-e.settings.margin.left)/2).attr("y",e.settings.margin.bottom/2+4).attr("fill","currentColor").attr("text-anchor","center").attr("alignment-baseline","hanging").text("Study Day")}))}function j(t){var e=this;return t.layout.timeSeries.yAxis.attr("transform","translate(".concat(this.settings.margin.left,",0)")).call(d3.axisLeft(t.yScale)).call((function(t){return t.select(".domain").remove()})).call((function(i){return i.append("g").attr("stroke","currentColor").attr("stroke-opacity",.1).selectAll("line").data(t.yScale.ticks()).join("line").attr("y1",(function(e){return.5+t.yScale(e)})).attr("y2",(function(e){return.5+t.yScale(e)})).attr("x1",0).attr("x2",e.settings.width-e.settings.margin.right-e.settings.margin.left)}))}function O(t){return t.layout.timeSeries.lines.selectAll("line").data(t.ids,(function(t){return t[0]})).join("line").attr("stroke-opacity",0)}function C(t){var e=this;return t.layout.timeSeries.points.selectAll("circle").data(t.ids,(function(t){return t[0]})).join("circle").attr("cx",(function(i){return t.xScale(e.util.getValue(i[1],"visit",e.timepoint.visit,e.settings.x_var))+("ordinal"===e.settings.x_type?t.xScale.bandwidth()/2:0)})).attr("cy",(function(i){return t.yScale(e.util.getValue(i[1],"visit",e.timepoint.visit,e.settings.y_var))})).attr("r",1).attr("fill",t.colorScale(0)).attr("fill-opacity",.25).attr("stroke",t.colorScale(0)).attr("stroke-opacity",.5)}function P(t){var e=this;return t.layout.timeSeries.linesAggregate.datum(t.aggregate).selectAll("line.atm-line-aggregate").data(d3.pairs(t.aggregate)).join("line").classed("atm-line-aggregate",!0).attr("x1",(function(i,n){return"ordinal"===e.settings.x_type?t.xScale(e.set.visit[n])+t.xScale.bandwidth()/2:t.xScale(e.set.timepoint[n])})).attr("x2",(function(i,n){return"ordinal"===e.settings.x_type?t.xScale(e.set.visit[n])+t.xScale.bandwidth()/2:t.xScale(e.set.timepoint[n])})).attr("y1",(function(e){return t.yScale(e[0][1])})).attr("y2",(function(e){return t.yScale(e[0][1])})).attr("stroke",(function(i){var n=i[1][1]-i[0][1];return"percent_change"===e.settings.color_var?t.colorScale(n/i[0][1]*100):t.colorScale(n)})).attr("stroke-width",3)}function R(t){return t.layout.timeSeries.pointsAggregate.append("circle").datum(t.aggregate).classed("atm-point-aggregate",!0).attr("cx","ordinal"===this.settings.x_type?t.xScale(this.timepoint.visit)+t.xScale.bandwidth()/2:t.xScale(this.timepoint.day)).attr("cy",(function(e){return t.yScale(e[0][1])})).attr("r",4).attr("fill",t.colorScale(0)).attr("fill-opacity",1).attr("stroke","black").attr("stroke-opacity",1)}function D(t){E.call(this,t),t.xAxis=k.call(this,t),t.yAxis=j.call(this,t),t.lines=O.call(this,t),t.points=C.call(this,t),t.linesAggregate=P.call(this,t),t.pointsAggregate=R.call(this,t)}function L(t){var e=this,n=this.util.addElement("filters",t).classed("atm-controls-spacing",!0),a=(this.util.addElement("filters__header",n,"span").text("Filters"),this.util.addElement("filter",n,"div",this.settings.filters)),r=this.util.addElement("filter__label",a,"span").text((function(t){return t.label})),s=this.util.addElement("filter__dropdown",a,"select").property("multiple",!0);return s.each((function(t,e,n){t.select=new i.default({select:this})})),s.on("change",(function(t,i){i.value=i.select.selected(),e.data.forEach((function(t){t.include=e.settings.filters.every((function(e){return e.value.includes(t[e.var])}))})),e.group.measure.forEach((function(t,i){t.ids=d3.groups(t.filter((function(t){return t.include})),(function(t){return t.id})),t.aggregate=e.set.visit.reduce((function(i,n){return i.push([n,d3[e.settings.aggregate](t.filter((function(t){return t.visit===n})),(function(t){return t.result})),d3[e.settings.aggregate](t.filter((function(t){return t.visit===n})),(function(t){return t.change})),d3[e.settings.aggregate](t.filter((function(t){return t.visit===n})),(function(t){return t.percent_change}))]),i}),[]),D.call(e,t)}))})),{container:n,containers:a,labels:r,input:s}}function V(t){var e=this.util.addElement("footnotes",t,"small");return e.html(this.settings.footnotes.join("<br>")),e}function z(t){var e=this.util.addElement("controls",t),i=this.util.addElement("timepoint",e).classed("atm-controls-spacing",!0).append("span"),n=this.util.addElement("animation",e).classed("atm-controls-spacing",!0);return this.controls={play:b.call(this,n),step:w.call(this,n),filters:L.call(this,e)},{controls:e,timepoint:i,animation:n,footnotes:V.call(this,e)}}function I(t){return this.util.addElement("charts",t)}function T(){var t=this;g.call(this),this.group.measure.forEach((function(e){e.layout.timeSeries.svg.attr("width",t.settings.width).attr("height",t.settings.height),e.xScale.rangeRound([t.settings.margin.left,t.settings.width-t.settings.margin.right]),e.yScale.rangeRound([t.settings.height-t.settings.margin.bottom,t.settings.margin.top]),D.call(t,e)}))}function q(){var t=this.util.addElement("main",d3.select(this.element)),e=z.call(this,t),i=I.call(this,t);return g.call(this,i),window.addEventListener("resize",T.bind(this)),c(c({main:t},e),{},{charts:i})}function B(){var t=this;this.data.every((function(t){return/^-?\d+\.?\d*$/.test(t.id)||/^-?\d*\.?\d+$/.test(t.id)}));this.data.forEach((function(e){e.include=!0,Object.keys(t.settings).filter((function(t){return/_var$/.test(t)})).forEach((function(i){e[i.replace(/_var$/,"")]=["visit_order_var","day_var","result_var","baseline_var","change_var","percent_change_var"].includes(i)?parseFloat(e[t.settings[i]]):e[t.settings[i]]}))}))}function M(t){var e;switch(t){case"visit":e=u(new Set(this.data.filter((function(t){return!(t.visit_order%1)})).map((function(t){return t.visit+"|"+t.visit_order}))).values()).sort((function(t,e){return t.replace(/.*\|/,"")-e.replace(/.*\|/,"")})).map((function(t){return t.replace(/\|.*$/,"")}));break;default:e=u(new Set(this.data.map((function(e){return e[t]}))).values()).sort()}return e}function F(){var t=this,e={};return e.id=M.call(this,"id"),e.visit=M.call(this,"visit"),e.day=M.call(this,"day"),e.measure=M.call(this,"measure"),e.timepoint=e.visit.map((function(e){return d3.median(t.data.filter((function(t){return t.visit===e})),(function(t){return t.day}))})),this.settings.filters&&this.settings.filters.forEach((function(i){e[i.var]=M.call(t,i.var)})),e}function $(){var t={};return t.id=A.call(this,"id"),t.visit=A.call(this,"visit"),t.measure=A.call(this,"measure"),t.measure_id=A.call(this,"measure,id"),t}function U(){if(this.settings.filters){var t=this;this.controls.filters.input.each((function(e){e.value=t.set[e.var],t.util.addElement("filter__option",d3.select(this),"option",t.set[e.var]).property("selected",!0).text((function(t){return t}))}))}}function Q(){B.call(this),this.data.filtered=this.data,this.set=F.call(this),this.group=$.call(this),U.call(this)}function G(t){var e;switch(this.settings.x_type){case"linear":e=d3.scaleLinear().domain(d3.extent(t,(function(t){return t.day})));break;case"ordinal":e=d3.scaleBand().domain(this.set.visit);break;case"log":d3.scaleLog().domain(d3.extent(t,(function(t){return t.day})));break;default:alert("[ ".concat(this.settings.x_type," ] is an invalid x-axis type.  Please choose one of [ 'linear', 'ordinal', 'log' ]."))}return e.rangeRound([this.settings.margin.left,this.settings.width-this.settings.margin.right]),e}function H(t){var e=this,i=null===this.settings.y_limits?[0,100]:this.settings.y_limits,n=t.map((function(t){return t[e.settings.y_var]})).sort((function(t,e){return t-e})),a=i.map((function(t){return d3.quantile(n,t/100)}));return d3.scaleLinear().domain(a).rangeRound([this.settings.height-this.settings.margin.bottom,this.settings.margin.top])}function J(t){var e=this,i="change"===this.settings.color_var?d3.max(t,(function(t){return Math.abs(t[e.settings.color_var])})):100;return d3.scaleSequential().domain([-i,i]).interpolator(d3.interpolateViridis).clamp(!0)}function N(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,i=document.createElement("canvas");i.width=e,i.height=1;for(var n=i.getContext("2d"),a=0;a<e;++a)n.fillStyle=t(a/(e-1)),n.fillRect(a,0,1,1);return i}function W(t,e){var i=e.toLowerCase().replace(/[^a-z0-9_]/g,"-"),n=this.util.addElement("container",this.layout.charts),a=this.util.addElement("header",n,"h3").text(e),r=this.util.addElement("legend",n);r.node().appendChild(function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.color,n=e.title,a=e.tickSize,r=void 0===a?6:a,s=e.width,l=void 0===s?320:s,o=e.height,c=void 0===o?44+r:o,u=e.marginTop,d=void 0===u?18:u,g=e.marginRight,h=void 0===g?0:g,f=e.marginBottom,p=void 0===f?16+r:f,m=e.marginLeft,v=void 0===m?0:m,y=e.ticks,x=void 0===y?l/64:y,S=e.tickFormat,_=e.tickValues,b=d3.create("svg").attr("width",l).attr("height",c).attr("viewBox",[0,0,l,c]).style("overflow","visible").style("display","block"),w=function(t){return t.selectAll(".tick line").attr("y1",d+p-c)};if(i.interpolate){var A=Math.min(i.domain().length,i.range().length);t=i.copy().rangeRound(d3.quantize(d3.interpolate(v,l-h),A)),b.append("image").attr("x",v).attr("y",d).attr("width",l-v-h).attr("height",c-d-p).attr("preserveAspectRatio","none").attr("xlink:href",N.call(this,i.copy().domain(d3.quantize(d3.interpolate(0,1),A))).toDataURL())}else if(i.interpolator){if(t=Object.assign(i.copy().interpolator(d3.interpolateRound(v,l-h)),{range:function(){return[v,l-h]}}),b.append("image").attr("x",v).attr("y",d).attr("width",l-v-h).attr("height",c-d-p).attr("preserveAspectRatio","none").attr("xlink:href",N.call(this,i.interpolator()).toDataURL()),!t.ticks){if(void 0===_){var E=Math.round(x+1);_=d3.range(E).map((function(t){return d3.quantile(i.domain(),t/(E-1))}))}"function"!=typeof S&&(S=d3.format(void 0===S?",f":S))}}else if(i.invertExtent){var k=i.thresholds?i.thresholds():i.quantiles?i.quantiles():i.domain(),j=void 0===S?function(t){return t}:"string"==typeof S?d3.format(S):S;t=d3.scaleLinear().domain([-1,i.range().length-1]).rangeRound([v,l-h]),b.append("g").selectAll("rect").data(i.range()).join("rect").attr("x",(function(e,i){return t(i-1)})).attr("y",d).attr("width",(function(e,i){return t(i)-t(i-1)})).attr("height",c-d-p).attr("fill",(function(t){return t})),_=d3.range(k.length),S=function(t){return j(k[t],t)}}else t=d3.scaleBand().domain(i.domain()).rangeRound([v,l-h]),b.append("g").selectAll("rect").data(i.domain()).join("rect").attr("x",t).attr("y",d).attr("width",Math.max(0,t.bandwidth()-1)).attr("height",c-d-p).attr("fill",i),w=function(){};return b.append("g").attr("transform","translate(0,".concat(c-p,")")).call(d3.axisBottom(t).ticks(x,"string"==typeof S?S:void 0).tickFormat("function"==typeof S?S:void 0).tickSize(r).tickValues(_)).call(w).call((function(t){return t.select(".domain").remove()})).call((function(t){t.append("text").attr("x",v).attr("y",d+p-c-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("font-size","1rem").text("-"),t.append("text").attr("x",l/2).attr("y",d+p-c-6).attr("fill","currentColor").attr("text-anchor","middle").attr("font-weight","bold").attr("font-size","1rem").html(n),t.append("text").attr("x",l-h).attr("y",d+p-c-6).attr("fill","currentColor").attr("text-anchor","end").attr("font-weight","bold").attr("font-size","1rem").text("+")})),b.node()}({color:t.colorScale,title:"change"===this.settings.color_var?"Change":'Percent Change <tspan dy = "-5" style = "font-size: 10px; font-weight: lighter">1 2</tspan>',width:275}));var s=this.util.addElement("time-series",n).classed("atm-svg-container",!0);s.svg=this.util.addElement("time-series__svg",s,"svg").attr("width",this.settings.width).attr("height",this.settings.height),s.xAxis=this.util.addElement("x-axis",s.svg,"g"),s.yAxis=this.util.addElement("y-axis",s.svg,"g"),s.canvas=this.util.addElement("canvas",s.svg,"g");return s.clipPath=this.util.addElement("clip-path",s.canvas,"clipPath").attr("id",i).append("rect").attr("x",this.settings.margin.left-6).attr("y",this.settings.margin.top).attr("width",this.settings.width-this.settings.margin.left-this.settings.margin.right+12).attr("height",this.settings.height-this.settings.margin.top-this.settings.margin.bottom),s.lines=this.util.addElement("lines",s.canvas,"g").attr("clip-path","url(#".concat(i,")")),s.points=this.util.addElement("points",s.canvas,"g").attr("clip-path","url(#".concat(i,")")),s.linesAggregate=this.util.addElement("lines-aggregate",s.canvas,"g").attr("clip-path","url(#".concat(i,")")),s.pointsAggregate=this.util.addElement("points-aggregate",s.canvas,"g").attr("clip-path","url(#".concat(i,")")),{main:n,header:a,legend:r,timeSeries:s}}function Y(){var t=this;this.timepoint=p.call(this),this.xScale=G.call(this,this.data),this.group.measure.forEach((function(e,i){e.data=e,e.xScale=t.xScale,e.yScale=H.call(t,e),e.colorScale=J.call(t,e),e.layout=W.call(t,e,i),e.ids=d3.groups(e.filter((function(t){return t.include})),(function(t){return t.id})),e.aggregate=t.set.visit.reduce((function(i,n){return i.push([n,d3[t.settings.aggregate](e.filter((function(t){return t.visit===n})),(function(t){return t.result})),d3[t.settings.aggregate](e.filter((function(t){return t.visit===n})),(function(t){return t.change})),d3[t.settings.aggregate](e.filter((function(t){return t.visit===n})),(function(t){return t.percent_change}))]),i}),[]),D.call(t,e)})),this.settings.play&&(this.interval=_.call(this))}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={data:t,element:e,settings:Object.assign(s(),i),util:a};return n.settings.update.call(n),n.layout=q.call(n),Q.call(n),Y.call(n),n}}));
